<!DOCTYPE html>
<html lang="en">
  <head> </head>
  <body>
    <h1>Please Enter the value here</h1>
    <div id="future"></div>
    <form id="form" id="chat_form">
      <input id="stock_name" type="text" />
      <button id="button" type="submit" value="Send" >submit</button>
    </form>
    <br />
    <br>
    <br>
    
    <canvas id="myChart" width="450" height="450"></canvas>

    <script src="/jquery/dist/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
  </body>
  <script>
    var socket = io.connect();
    socket.on("connect", function(data) {
      socket.emit("join", "Hello World from client");
    });
    socket.on("broad", function(data) {
      $("#future").append(data + "<br/>");
    });
    
    socket.on("data", function(message) {
      let vals = [];
      let label =[];
      for (let val of message) {
        vals.push(val.volume);
        const date= new Date(parseInt(val.timeStamp)); 
        console.log('parseInt(val.timeStamp));: ', parseInt(val.timeStamp));
        console.log('date: ', date);
        console.log('date.toTimeString(): ', date.toTimeString()); 
        label.push(date.toTimeString());
        
      }
      adddata(vals,label);
    });
    $("form").submit(function(e) {
      e.preventDefault();
      var message = $("#stock_name").val();
      let button= $("#button");
      button.prop('disabled', true);
      socket.emit("sendStock", message);
    });
    var canvas = document.getElementById("myChart");
    var myBarChart = Chart.Bar(canvas, {
      data: {
        labels: [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July"
        ],
        datasets: [
          {
            label: "Volume Traded",
            data: [65, 59, 80, 81, 56, 55, 40],
            backgroundColor: [
              "rgba(255, 99, 132, 0.2)",
              "rgba(54, 162, 235, 0.2)",
              "rgba(255, 206, 86, 0.2)",
              "rgba(75, 192, 192, 0.2)",
              "rgba(153, 102, 255, 0.2)",
              "rgba(255, 159, 64, 0.2)"
            ],
            borderColor: [
              "rgba(255,99,132,1)",
              "rgba(54, 162, 235, 1)",
              "rgba(255, 206, 86, 1)",
              "rgba(75, 192, 192, 1)",
              "rgba(153, 102, 255, 1)",
              "rgba(255, 159, 64, 1)"
            ],

            borderWidth: 1
          }
        ]
      },
      options: {
        scales: {
          yAxes: [
            {
              stacked: true,
              gridLines: {
                display: true,
                color: "rgba(255,99,132,0.2)"
              }
            }
          ],
          xAxes: [
            {
              barPercentage: 0.5,
              gridLines: {
                display: false
              }
            }
          ]
        }
      }
    });
    function adddata(data,label) {
      myBarChart.data.datasets[0].data = data;
      myBarChart.data.labels=label;
      myBarChart.update();
    }
  </script>
</html>
